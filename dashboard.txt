import { useState } from "react"
import { FaComments, FaExclamationTriangle, FaEye, FaFileAlt, FaFilter, FaSearch, FaThumbsUp } from "react-icons/fa"
import Slidebar from "../components/Slidebar"
import { Badge } from "../components/ui/badge"
import { Button } from "../components/ui/button"
import { Card, CardContent } from "../components/ui/card"
import { Input } from "../components/ui/input"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "../components/ui/table"
import { UndoIcon } from "lucide-react"

// Datos de ejemplo para el dashboard
const mockPqrsdf = [
	{
		id: 1,
		tipo: "Petición",
		asunto: "Solicitud de información",
		estado: "Pendiente",
		fecha: "2023-05-15",
		prioridad: "Media",
	},
	{
		id: 2,
		tipo: "Queja",
		asunto: "Problema con el servicio",
		estado: "En proceso",
		fecha: "2023-05-10",
		prioridad: "Alta",
	},
	{
		id: 3,
		tipo: "Reclamo",
		asunto: "Facturación incorrecta",
		estado: "Resuelto",
		fecha: "2023-05-05",
		prioridad: "Alta",
	},
	{
		id: 4,
		tipo: "Sugerencia",
		asunto: "Mejora del portal web",
		estado: "Pendiente",
		fecha: "2023-05-01",
		prioridad: "Baja",
	},
	{
		id: 5,
		tipo: "Denuncia",
		asunto: "Irregularidad en proceso",
		estado: "En proceso",
		fecha: "2023-04-28",
		prioridad: "Alta",
	},
	{
		id: 6,
		tipo: "Felicitación",
		asunto: "Excelente atención",
		estado: "Cerrado",
		fecha: "2023-04-25",
		prioridad: "Baja",
	},
]

export default function Dashboard() {
	const [searchTerm, setSearchTerm] = useState("")
	const [filteredData, setFilteredData] = useState(mockPqrsdf)
	const [selectedTipo, setSelectedTipo] = useState<string | undefined>(undefined)
	const [selectedEstado, setSelectedEstado] = useState<string | undefined>(undefined)
	const [Username, setUsername] = useState<string | undefined>(undefined)

	// Estadísticas
	const stats = {
		total: mockPqrsdf.length,
		pendientes: mockPqrsdf.filter((item) => item.estado === "Pendiente").length,
		enProceso: mockPqrsdf.filter((item) => item.estado === "En proceso").length,
		resueltos: mockPqrsdf.filter((item) => item.estado === "Resuelto" || item.estado === "Cerrado").length,
	}

	const getUsername = () => {
		const storeUsername = sessionStorage.getItem("persona")
		const persona = JSON.parse(storeUsername || "{}")

		return persona.nombre || "Usuario"
	}

	const getUserletter = () => {
		const storeUsername = sessionStorage.getItem("persona")
		const persona = JSON.parse(storeUsername || "{}")

		return persona.nombre ? persona.nombre.charAt(0).toUpperCase() : "U"
	}
	// Filtrar datos
	const handleFilter = () => {
		let filtered = mockPqrsdf

		if (searchTerm) {
			filtered = filtered.filter(
				(item) =>
					item.asunto.toLowerCase().includes(searchTerm.toLowerCase()) ||
					item.tipo.toLowerCase().includes(searchTerm.toLowerCase()),
			)
		}

		if (selectedTipo) {
			filtered = filtered.filter((item) => item.tipo === selectedTipo)
		}

		if (selectedEstado) {
			filtered = filtered.filter((item) => item.estado === selectedEstado)
		}

		setFilteredData(filtered)
	}

	// Resetear filtros
	const resetFilters = () => {
		setSearchTerm("")
		setSelectedTipo(undefined)
		setSelectedEstado(undefined)
		setFilteredData(mockPqrsdf)
	}

	
	// Obtener el color de la badge según el estado
	const getStatusColor = (estado: string) => {
		switch (estado) {
			case "Pendiente":
				return "bg-yellow-500 text-white"
			case "En proceso":
				return "bg-blue-500 text-white"
			case "Resuelto":
				return "bg-green-500 text-white"
			case "Cerrado":
				return "bg-gray-500 text-white"
			default:
				return "bg-gray-500 text-white"
		}
	}

	// Obtener el icono según el tipo de PQRSDF
	const getTipoIcon = (tipo: string) => {
		switch (tipo) {
			case "Petición":
				return <FaFileAlt className="text-blue-500" />
			case "Queja":
				return <FaExclamationTriangle className="text-red-500" />
			case "Reclamo":
				return <FaExclamationTriangle className="text-orange-500" />
			case "Sugerencia":
				return <FaComments className="text-purple-500" />
			case "Denuncia":
				return <FaExclamationTriangle className="text-red-700" />
			case "Felicitación":
				return <FaThumbsUp className="text-green-500" />
			default:
				return <FaFileAlt className="text-gray-500" />
		}
	}

	return (
		<div className="flex min-h-screen w-screen bg-gray-100 z-15">
			{/* Sidebar */}
			<div className="bg-blue-900 fixed left-0 top-0 h-full z-50 w-14">
				<Slidebar />
			</div>

			{/* Contenido principal */}
			<div className="ml-14 w-full">
				<div className="max-w-7xl mx-auto p-6">
					{/* Header */}
					<div className="flex justify-between items-center mb-6">
						<h1 className="text-2xl font-bold text-blue-900">Panel de PQRSDF</h1>
						<div className="flex items-center gap-2">
							<span className="text-sm">Bienvenido, {getUsername()}</span>
							<div className="w-8 h-8 rounded-full bg-blue-900 flex items-center justify-center text-white">{getUserletter()}</div>
						</div>
					</div>

					{/* Tarjetas de estadísticas */}
					<div className="grid grid-cols-4 gap-4 mb-6">
						<Card className="bg-white shadow-sm">
							<CardContent className="p-4">
								<div className="text-sm text-gray-600">Total PQRSDF</div>
								<div className="text-2xl font-bold">{stats.total}</div>
							</CardContent>
						</Card>

						<Card className="bg-white shadow-sm">
							<CardContent className="p-4">
								<div className="text-sm text-gray-600">Pendientes</div>
								<div className="text-2xl font-bold text-yellow-500">{stats.pendientes}</div>
							</CardContent>
						</Card>

						<Card className="bg-white shadow-sm">
							<CardContent className="p-4">
								<div className="text-sm text-gray-600">En Proceso</div>
								<div className="text-2xl font-bold text-blue-500">{stats.enProceso}</div>
							</CardContent>
						</Card>

						<Card className="bg-white shadow-sm">
							<CardContent className="p-4">
								<div className="text-sm text-gray-600">Resueltos</div>
								<div className="text-2xl font-bold text-green-500">{stats.resueltos}</div>
							</CardContent>
						</Card>
					</div>

					{/* Filtros */}
					<Card className="mb-6 bg-white shadow-sm">
						<CardContent className="p-4">
							<div className="flex items-center gap-4">
								<div className="relative flex-1">
									<FaSearch className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" />
									<Input
										placeholder="Buscar por asunto o tipo..."
										className="pl-10 border-gray-300"
										value={searchTerm}
									/>
								</div>

								<Button className="text-white ">
									Tipo de PQRSDF
								</Button>

								<Button className="text-white">
									Estado
								</Button>

								<Button className="text-white">
									<FaFilter className="mr-2" /> Filtrar
								</Button>

								<Button className="text-white" onClick={resetFilters}>
									Limpiar
								</Button>
							</div>
						</CardContent>
					</Card>

					{/* Tabla de PQRSDF */}
					<Card className="bg-white shadow-sm">
						<CardContent className="p-4">
							<h2 className="text-lg font-semibold mb-4">Listado de PQRSDF</h2>

							<div className="overflow-x-auto">
								<Table>
									<TableHeader>
										<TableRow>
											<TableHead className="font-semibold">ID</TableHead>
											<TableHead className="font-semibold">Tipo</TableHead>
											<TableHead className="font-semibold">Asunto</TableHead>
											<TableHead className="font-semibold">Estado</TableHead>
											<TableHead className="font-semibold">Fecha</TableHead>
											<TableHead className="font-semibold">Prioridad</TableHead>
											<TableHead className="font-semibold">Acciones</TableHead>
										</TableRow>
									</TableHeader>
									<TableBody>
										{filteredData.map((item) => (
											<TableRow key={item.id}>
												<TableCell>{item.id}</TableCell>
												<TableCell>
													<div className="flex items-center gap-2">
														{getTipoIcon(item.tipo)}
														{item.tipo}
													</div>
												</TableCell>
												<TableCell>{item.asunto}</TableCell>
												<TableCell>
													<Badge className={getStatusColor(item.estado)}>{item.estado}</Badge>
												</TableCell>
												<TableCell>{item.fecha}</TableCell>
												<TableCell>
													<Badge
														variant="outline"
														className={
															item.prioridad === "Alta"
																? "border-red-500 text-red-500"
																: item.prioridad === "Media"
																	? "border-yellow-500 text-yellow-500"
																	: "border-green-500 text-green-500"
														}
													>
														{item.prioridad}
													</Badge>
												</TableCell>
												<TableCell>
													<Button
														size="sm"
														className="bg-black text-white hover:bg-gray-800 rounded-md"
													>
														<FaEye className="mr-1" /> Ver
													</Button>
												</TableCell>
											</TableRow>
										))}
									</TableBody>
								</Table>
							</div>
						</CardContent>
					</Card>
				</div>
			</div>
		</div>
	)
}

